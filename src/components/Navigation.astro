---
// Navigation component with responsive design
// Mobile: bottom navigation, Desktop: topbar navigation
import { UserMenu } from "./UserMenu";
import { NavigationMenu } from "./NavigationMenu";
---

<nav
  class="fixed bottom-0 left-0 right-0 z-50 md:bottom-auto md:top-0 bg-background border-t md:border-b md:border-t-0 border-border"
>
  <!-- Desktop Navigation (md and up) -->
  <div class="hidden md:block">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <!-- Logo -->
        <div class="flex-shrink-0">
          <a href="/" class="text-xl font-bold text-primary"> HealthyMeal </a>
        </div>

        <!-- Navigation Links -->
        <NavigationMenu client:load />

        <!-- Theme Toggle and User Menu -->
        <div class="flex items-center space-x-4">
          <button
            id="theme-toggle"
            class="p-2 rounded-md text-foreground hover:bg-accent transition-colors"
            aria-label="Przełącz motyw"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
              ></path>
            </svg>
          </button>
          
          <!-- User Menu -->
          <div class="flex items-center">
            <UserMenu client:load />
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Navigation (bottom) -->
  <div class="md:hidden">
    <NavigationMenu client:load />
  </div>
</nav>

<!-- Spacer for mobile bottom navigation -->
<div class="md:hidden h-16"></div>

<!-- Spacer for desktop top navigation -->
<div class="hidden md:block h-16"></div>

<script>
  // Theme toggle functionality
  const themeToggle = document.getElementById("theme-toggle");
  const html = document.documentElement;

  // Get saved theme from localStorage
  const savedTheme = localStorage.getItem("theme") || "system";

  // Apply theme
  function applyTheme(theme: string) {
    if (theme === "dark") {
      html.classList.add("dark");
    } else if (theme === "light") {
      html.classList.remove("dark");
    } else {
      // System theme
      if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
        html.classList.add("dark");
      } else {
        html.classList.remove("dark");
      }
    }
  }

  // Initialize theme
  applyTheme(savedTheme);

  // Theme toggle click handler
  themeToggle?.addEventListener("click", () => {
    const currentTheme = html.classList.contains("dark") ? "dark" : "light";
    const newTheme = currentTheme === "dark" ? "light" : "dark";

    localStorage.setItem("theme", newTheme);
    applyTheme(newTheme);
  });

  // Listen for system theme changes
  window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", (e) => {
    if (localStorage.getItem("theme") === "system") {
      applyTheme("system");
    }
  });


</script>
